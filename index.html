<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>SVR | MISSION CONTROL</title>
  <style>
    :root { --neon:#00ff00; --panel:rgba(0,10,0,0.95); --cyan:#00ffff; --err:#ff0055; }
    body { margin:0; overflow:hidden; background:#000; font-family:Courier New, monospace; color:var(--neon); }
    #diag-hud { position:absolute; top:10px; left:10px; border:1px solid var(--neon); padding:12px; background:var(--panel); z-index:1000; width:280px; display:none; }
    #term-log { position:absolute; bottom:160px; left:10px; right:10px; height:110px; background:rgba(0,0,0,0.85); border-left:4px solid var(--cyan); padding:10px; font-size:10px; overflow-y:auto; color:#8f8; display:none; }
    .cmd-btn { background:#000; border:1px solid var(--neon); color:var(--neon); padding:12px; cursor:pointer; font-size:11px; text-transform:uppercase; min-width:160px; }
  </style>
</head>
<body>
  <div id="diag-hud">
    <div style="font-weight:bold;color:var(--cyan)">[ SVR-CORE MONITOR ]</div>
    STATUS: <span id="st-val" style="color:var(--err)">OFFLINE</span><br>
    MODE: <span id="mode-val" style="color:var(--cyan)">PERMANENT</span><br>
    XYZ: <span id="pos-val">0.0, 1.6, 0.0</span>
  </div>
  <div id="term-log">> BOOT...</div>

  <div style="position:absolute; bottom:20px; width:100%; text-align:center;">
    <button id="entervr" class="cmd-btn">INITIALIZE VR SESSION</button>
  </div>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>

  <script type="module">
    import { initEngine } from './js/scarlett1/index.js';

    const params = new URLSearchParams(location.search);
    const dev = params.get('dev') === '1' || params.get('dev') === 'true';
    document.getElementById('mode-val').innerText = dev ? 'DEV' : 'PERMANENT';
    document.getElementById('diag-hud').style.display = dev ? 'block' : 'none';
    document.getElementById('term-log').style.display = dev ? 'block' : 'none';

    function log(msg){
      const term = document.getElementById('term-log');
      if(!term || term.style.display === 'none') return;
      term.innerHTML += `<br>> ${msg}`;
      term.scrollTop = term.scrollHeight;
    }

    initEngine();

    const st = document.getElementById('st-val');
    st.innerText = 'ACTIVE';
    st.style.color = '#0f0';
    log('ENGINE ACTIVE');

    document.getElementById('entervr').addEventListener('click', async () => {
      // three.js will show its own XR button in some setups; this is a simple "try enter"
      try {
        if (!navigator.xr) { log('WebXR not available'); return; }
        const ok = await navigator.xr.isSessionSupported('immersive-vr');
        if (!ok) { log('immersive-vr not supported'); return; }
        log('Use browser XR UI to enter VR (Quest: Oculus Browser)');
      } catch (e) {
        log('Enter VR error: ' + (e?.message || e));
      }
    });
  </script>
</body>
</html>
