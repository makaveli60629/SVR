<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b0b12"/>
  <title>ScarlettVR Poker ‚Ä¢ SVR</title>
  <style>
    html,body{margin:0;height:100%;background:#05050a;color:#e9e9ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    canvas{display:block;touch-action:none}
    #hud{position:fixed;left:10px;top:10px;right:10px;max-width:940px;z-index:9999}
    #bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{padding:10px 14px;border-radius:18px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.35);color:#fff;font-weight:700}
    #status{padding:8px 12px;border-radius:14px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.10);font-weight:800}
    #panel{margin-top:10px;padding:12px 14px;border-radius:18px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.10);
      max-height:44vh;overflow:auto;white-space:pre-wrap;
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
      font-size:13px;line-height:1.25;}
    #hint{position:fixed;left:10px;right:10px;bottom:10px;z-index:9998;opacity:.75;font-size:13px;text-shadow:0 1px 2px rgba(0,0,0,.8)}
  </style>
</head>
<body>
  <div id="hud">
    <div id="bar">
      <div id="status">boot‚Ä¶</div>
      <button id="btnVR" class="btn">Enter VR</button>
      <button id="btnSpawn" class="btn">Reset Spawn</button>
      <button id="btnReload" class="btn">Hard Reload</button>
      <button id="btnNuke" class="btn">NUKE CACHE</button>
      <button id="btnProbe" class="btn">PROBE PATHS</button>
    </div>
    <div id="panel"><div id="log">[hud] mounted\n</div></div>
  </div>

  <div id="hint">Quest: thumbsticks move ‚Ä¢ trigger teleports ‚Ä¢ hand tracking: pinch teleports</div>

  <script>
    // ALWAYS RUNS (even if module loading is broken)
    const $ = (id)=>document.getElementById(id);
    const logEl = $("log");
    const statusEl = $("status");

    function log(msg){
      try{
        logEl.textContent += String(msg) + "\n";
        logEl.parentElement.scrollTop = logEl.parentElement.scrollHeight;
      }catch(e){}
      console.log(msg);
    }
    function setStatus(t){ statusEl.textContent = t; }

    log("=== SCARLETT DIAGNOSTICS (INLINE BOOT) ===");
    log("href=" + location.href);
    log("origin=" + location.origin);
    log("path=" + location.pathname);
    log("ua=" + navigator.userAgent);
    log("secureContext=" + String(window.isSecureContext));
    log("navigator.xr=" + (!!navigator.xr));
    setStatus("boot‚Ä¶ (inline)");

    window.addEventListener("error", (e)=>{
      log("‚ùå window.error: " + (e?.message || e));
      if (e?.error?.stack) log(e.error.stack);
      setStatus("error ‚ùå");
    });
    window.addEventListener("unhandledrejection", (e)=>{
      log("‚ùå unhandledrejection: " + (e?.reason?.message || e?.reason || e));
      if (e?.reason?.stack) log(e.reason.stack);
      setStatus("error ‚ùå");
    });

    $("btnReload").onclick = ()=> location.reload(true);

    $("btnNuke").onclick = async ()=>{
      log("üß® NUKE CACHE: starting‚Ä¶");
      try{
        if ("serviceWorker" in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          for (const r of regs) await r.unregister();
          log("‚úÖ service workers unregistered: " + regs.length);
        }
        if ("caches" in window){
          const keys = await caches.keys();
          for (const k of keys) await caches.delete(k);
          log("‚úÖ caches cleared: " + keys.length);
        }
      }catch(err){
        log("‚ö†Ô∏è nuke failed: " + (err?.message || err));
      }
      log("üîÅ reloading‚Ä¶");
      location.reload(true);
    };

    // PROBE PATHS: tells us instantly if your files are actually being served
    $("btnProbe").onclick = async ()=>{
      const targets = [
        "./index.js",
        "./js/runtime/spine.js",
        "./js/runtime/input.js",
        "./scarlett1/world.js"
      ];
      log("‚Äî PROBE PATHS ‚Äî");
      for (const t of targets){
        try{
          const r = await fetch(t, { cache:"no-store" });
          log((r.ok?"‚úÖ ":"‚ùå ") + t + "  status=" + r.status);
        }catch(e){
          log("‚ùå " + t + "  fetch error");
        }
      }
      log("‚Äî END PROBE ‚Äî");
    };

    $("btnSpawn").onclick = ()=> { window.__SVR_RESET_SPAWN?.(); log("‚ñ∂ Reset Spawn pressed"); };
    $("btnVR").onclick = ()=> { window.__SVR_ENTER_VR?.(); log("‚ñ∂ Enter VR pressed"); };

    // IMPORTANT: dynamic import from inline script (no silent failure)
    (async ()=>{
      try{
        setStatus("loading‚Ä¶");
        log("‚Ä¶ dynamic importing ./js/runtime/spine.js");
        const mod = await import("./js/runtime/spine.js?v=" + Date.now());
        if (!mod?.Spine?.start) throw new Error("Spine.start missing export");
        log("‚úÖ Spine module loaded");

        await mod.Spine.start();
        setStatus("ready ‚úÖ");
        log("‚úÖ boot complete");
      }catch(e){
        setStatus("boot failed ‚ùå");
        log("‚ùå boot failed: " + (e?.message || e));
        if (e?.stack) log(e.stack);
      }
    })();
  </script>
</body>
</html>
